<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ì†¡ëŒ€ ê²½ì˜í•™ê³¼ ì»¤ë®¤ë‹ˆí‹°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, Timestamp, doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´ í•„ìš”)
        const firebaseConfig = {
	apiKey: "AIzaSyAs-c0kqgdZt604hx6tN2OQMnjqLpzKspY",
 	authDomain: "snsn-743cf.firebaseapp.com",
 	projectId: "snsn-743cf",
 	storageBucket: "snsn-743cf.firebasestorage.app",
 	messagingSenderId: "620814140186",
	appId: "1:620814140186:web:d26b0365a520da5bf9a2a3"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ì „ì—­ ìƒíƒœ
        let currentUser = null;
        let currentBoard = 'qa';
        let posts = [];

        // DOM ìš”ì†Œ
        const loginScreen = document.getElementById('loginScreen');
        const registerScreen = document.getElementById('registerScreen');
        const mainScreen = document.getElementById('mainScreen');
        const postDetailScreen = document.getElementById('postDetailScreen');

        // ë¡œê·¸ì¸
        window.loginUser = async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                document.getElementById('loginError').textContent = '';
            } catch (error) {
                document.getElementById('loginError').textContent = 'ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message;
            }
        };

        // íšŒì›ê°€ì…
        window.registerUser = async () => {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const name = document.getElementById('regName').value;
            const studentId = document.getElementById('regStudentId').value;
            
            if (password.length < 6) {
                document.getElementById('registerError').textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                // Firestoreì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
                await addDoc(collection(db, 'users'), {
                    uid: userCredential.user.uid,
                    email: email,
                    name: name,
                    studentId: studentId,
                    isInternational: document.getElementById('regIsInternational').checked,
                    createdAt: Timestamp.now()
                });
                document.getElementById('registerError').textContent = '';
            } catch (error) {
                document.getElementById('registerError').textContent = 'íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message;
            }
        };

        // ë¡œê·¸ì•„ì›ƒ
        window.logoutUser = async () => {
            await signOut(auth);
        };

        // í™”ë©´ ì „í™˜
        window.showRegisterScreen = () => {
            loginScreen.classList.add('hidden');
            registerScreen.classList.remove('hidden');
        };

        window.showLoginScreen = () => {
            registerScreen.classList.add('hidden');
            loginScreen.classList.remove('hidden');
        };

        // ê²Œì‹œíŒ ì „í™˜
        window.switchBoard = (boardType) => {
            currentBoard = boardType;
            document.querySelectorAll('.board-tab').forEach(tab => {
                tab.classList.remove('bg-blue-900', 'text-white');
                tab.classList.add('text-gray-600');
            });
            event.target.classList.add('bg-blue-900', 'text-white');
            event.target.classList.remove('text-gray-600');
            loadPosts();
        };

        // ê²Œì‹œê¸€ ì‘ì„±
        window.createPost = async () => {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                await addDoc(collection(db, 'posts'), {
                    authorId: currentUser.uid,
                    authorName: currentUser.displayName || currentUser.email.split('@')[0],
                    boardType: currentBoard,
                    title: title,
                    content: content,
                    originalLanguage: 'ko',
                    isResolved: false,
                    viewCount: 0,
                    commentCount: 0,
                    createdAt: Timestamp.now()
                });
                
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                document.getElementById('newPostModal').classList.add('hidden');
                loadPosts();
            } catch (error) {
                alert('ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨: ' + error.message);
            }
        };

        // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
        async function loadPosts() {
            const postsContainer = document.getElementById('postsContainer');
            postsContainer.innerHTML = '<div class="text-center py-8 text-gray-500">ë¡œë”© ì¤‘...</div>';

            try {
                const q = query(
                    collection(db, 'posts'),
                    orderBy('createdAt', 'desc')
                );
                const querySnapshot = await getDocs(q);
                posts = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.boardType === currentBoard) {
                        posts.push({ id: doc.id, ...data });
                    }
                });

                if (posts.length === 0) {
                    postsContainer.innerHTML = '<div class="text-center py-8 text-gray-500">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                postsContainer.innerHTML = posts.map(post => `
                    <div onclick="viewPost('${post.id}')" class="bg-white rounded-lg shadow hover:shadow-md transition p-4 cursor-pointer">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                ${post.authorName[0].toUpperCase()}
                            </div>
                            <span class="text-sm font-medium text-gray-700">${post.authorName}</span>
                            ${post.isResolved ? '<span class="ml-auto text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium">í•´ê²°ë¨</span>' : ''}
                        </div>
                        <h2 class="text-base font-bold text-gray-900 mb-1">${post.title}</h2>
                        <p class="text-sm text-gray-600 line-clamp-2">${post.content}</p>
                        <div class="flex items-center gap-4 mt-3 text-xs text-gray-500">
                            <span>ğŸ‘ ${post.viewCount}</span>
                            <span>ğŸ’¬ ${post.commentCount}</span>
                            <span>${new Date(post.createdAt.seconds * 1000).toLocaleDateString('ko-KR')}</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                postsContainer.innerHTML = `<div class="text-center py-8 text-red-500">ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°
        window.viewPost = async (postId) => {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            // ì¡°íšŒìˆ˜ ì¦ê°€
            await updateDoc(doc(db, 'posts', postId), {
                viewCount: post.viewCount + 1
            });

            document.getElementById('detailTitle').textContent = post.title;
            document.getElementById('detailAuthor').textContent = post.authorName;
            document.getElementById('detailContent').textContent = post.content;
            document.getElementById('detailDate').textContent = new Date(post.createdAt.seconds * 1000).toLocaleString('ko-KR');

            mainScreen.classList.add('hidden');
            postDetailScreen.classList.remove('hidden');
        };

        // ë’¤ë¡œ ê°€ê¸°
        window.goBack = () => {
            postDetailScreen.classList.add('hidden');
            mainScreen.classList.remove('hidden');
            loadPosts();
        };

        // ëª¨ë‹¬ ì œì–´
        window.showNewPostModal = () => {
            document.getElementById('newPostModal').classList.remove('hidden');
        };

        window.closeNewPostModal = () => {
            document.getElementById('newPostModal').classList.add('hidden');
        };

        // ë²ˆì—­ ê¸°ëŠ¥ (ë°ëª¨)
        window.translateContent = async (type) => {
            const element = document.getElementById(type === 'post' ? 'detailContent' : 'detailContent');
            const currentText = element.textContent;
            
            // ì‹¤ì œë¡œëŠ” Google Translation API í˜¸ì¶œ
            if (element.dataset.translated === 'true') {
                element.textContent = element.dataset.original;
                element.dataset.translated = 'false';
            } else {
                element.dataset.original = currentText;
                element.textContent = '[ë²ˆì—­ë¨] ' + currentText;
                element.dataset.translated = 'true';
            }
        };

        // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                loginScreen.classList.add('hidden');
                registerScreen.classList.add('hidden');
                mainScreen.classList.remove('hidden');
                document.getElementById('userEmail').textContent = user.email;
                loadPosts();
            } else {
                currentUser = null;
                mainScreen.classList.add('hidden');
                postDetailScreen.classList.add('hidden');
                loginScreen.classList.remove('hidden');
            }
        });
    </script>
</head>
<body class="bg-gray-50">
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-900 mb-2">ìš°ì†¡ëŒ€ ê²½ì˜í•™ê³¼</h1>
                <p class="text-gray-600">í•™ìƒ ì»¤ë®¤ë‹ˆí‹°</p>
            </div>
            
            <div class="space-y-4">
                <input id="loginEmail" type="email" placeholder="ì´ë©”ì¼" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="loginPassword" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p id="loginError" class="text-red-500 text-sm"></p>
                <button onclick="loginUser()" 
                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                    ë¡œê·¸ì¸
                </button>
                <button onclick="showRegisterScreen()" 
                    class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
                    íšŒì›ê°€ì…
                </button>
            </div>
        </div>
    </div>

    <!-- íšŒì›ê°€ì… í™”ë©´ -->
    <div id="registerScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold text-blue-900 mb-6">íšŒì›ê°€ì…</h2>
            
            <div class="space-y-4">
                <input id="regName" type="text" placeholder="ì´ë¦„" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="regStudentId" type="text" placeholder="í•™ë²ˆ" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="regEmail" type="email" placeholder="ì´ë©”ì¼" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="regPassword" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ìµœì†Œ 6ì)" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <label class="flex items-center gap-2">
                    <input id="regIsInternational" type="checkbox" class="w-4 h-4">
                    <span class="text-sm text-gray-700">ìœ í•™ìƒì…ë‹ˆë‹¤</span>
                </label>
                <p id="registerError" class="text-red-500 text-sm"></p>
                <button onclick="registerUser()" 
                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                    ê°€ì…í•˜ê¸°
                </button>
                <button onclick="showLoginScreen()" 
                    class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
                    ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen" class="hidden min-h-screen">
        <!-- í—¤ë” -->
        <header class="bg-blue-900 text-white py-4 px-6 sticky top-0 z-10 shadow-md">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-bold">ìš°ì†¡ëŒ€ ì»¤ë®¤ë‹ˆí‹°</h1>
                <div class="flex items-center gap-4">
                    <span id="userEmail" class="text-sm"></span>
                    <button onclick="logoutUser()" class="text-sm bg-blue-800 px-3 py-1 rounded hover:bg-blue-700">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
        </header>

        <!-- ê²Œì‹œíŒ íƒ­ -->
        <div class="bg-white border-b sticky top-16 z-10">
            <div class="flex overflow-x-auto">
                <button onclick="switchBoard('qa')" 
                    class="board-tab px-6 py-3 font-medium transition bg-blue-900 text-white">
                    ë¬¸ì œ ì§ˆë¬¸
                </button>
                <button onclick="switchBoard('community')" 
                    class="board-tab px-6 py-3 font-medium transition text-gray-600">
                    ì†Œí†µ
                </button>
                <button onclick="switchBoard('info')" 
                    class="board-tab px-6 py-3 font-medium transition text-gray-600">
                    ì •ë³´ ê³µìœ 
                </button>
            </div>
        </div>

        <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
        <main id="postsContainer" class="p-4 space-y-3 pb-24">
            <!-- ê²Œì‹œê¸€ì´ ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
        </main>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
        <button onclick="showNewPostModal()" 
            class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition flex items-center justify-center text-2xl">
            +
        </button>
    </div>

    <!-- ê²Œì‹œê¸€ ìƒì„¸ í™”ë©´ -->
    <div id="postDetailScreen" class="hidden min-h-screen bg-gray-50">
        <header class="bg-blue-900 text-white py-4 px-6 sticky top-0 z-10 shadow-md flex items-center gap-4">
            <button onclick="goBack()" class="text-2xl">â†</button>
            <h1 class="text-lg font-bold">ê²Œì‹œê¸€ ìƒì„¸</h1>
        </header>

        <main class="p-6 bg-white">
            <div class="flex items-start justify-between mb-4">
                <h1 id="detailTitle" class="text-xl font-bold text-gray-900 flex-1"></h1>
                <button onclick="translateContent('post')" 
                    class="ml-2 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition">
                    ğŸŒ ë²ˆì—­
                </button>
            </div>

            <div class="flex items-center gap-2 mb-4 text-sm text-gray-600">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                    U
                </div>
                <div>
                    <p id="detailAuthor" class="font-medium text-gray-900"></p>
                    <p id="detailDate" class="text-xs"></p>
                </div>
            </div>

            <div class="prose prose-sm max-w-none mb-6">
                <p id="detailContent" class="text-gray-800 leading-relaxed"></p>
            </div>

            <hr class="my-6">

            <div>
                <h2 class="text-lg font-bold mb-4">ëŒ“ê¸€</h2>
                <div class="bg-gray-50 rounded-lg p-4 text-center text-gray-500">
                    ëŒ“ê¸€ ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.
                </div>
            </div>
        </main>
    </div>

    <!-- ìƒˆ ê²Œì‹œê¸€ ëª¨ë‹¬ -->
    <div id="newPostModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg w-full max-w-2xl p-6">
            <h2 class="text-xl font-bold mb-4">ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h2>
            <input id="postTitle" type="text" placeholder="ì œëª©" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <textarea id="postContent" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" 
                rows="6"></textarea>
            <div class="flex gap-2">
                <button onclick="createPost()" 
                    class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                    ì‘ì„±í•˜ê¸°
                </button>
                <button onclick="closeNewPostModal()" 
                    class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>
</body>
</html>